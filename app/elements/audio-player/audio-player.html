<dom-module id="audio-player">
  <link rel="stylesheet" href="audio-player.css">
  <template>
    <audio id="player" src="{{ url }}"></audio>
    <!--core-tooltip flex self-center label="{{ url }}">
      {{ name }}
    </core-tooltip-->
    <paper-icon-button icon="av:play-arrow" id="playPause" on-click="playPause">
    </paper-icon-button>
  </template>
  <script>
    (function () {
      'use strict';

      /* jshint -W064 */
      Polymer({
      /* jshint +W064 */
        is: 'audio-player',

        properties: {
          url: String,
          name: String,
          volume: {
            type: Number,
            observer: 'volumeChanged'
          },
          muted: {
            type: Boolean,
            observer: 'mutedChanged'
          }
        },

        ready: function() {
          this.muted = this.$.player.muted;
          this.volume = this.$.player.volume;
        },

        volumeChanged: function(newValue, oldValue) {
          this.$.player.volume = newValue;
        },

        mutedChanged: function(newValue, oldValue) {
          this.$.player.muted = newValue;
        },

        //TODO: find out why this doens't work, that'd be neat!
        // observe: {
        //   '$.player.paused': 'updateIcon',
        //   '$.player.volume': 'updateVolume'
        // },

        updateIcon: function() {
          this.$.playPause.icon = this.$.player.paused ? 'av:play-arrow' : 'av:pause';
        },

        updateVolume: function() {
          console.log('updateVolume', arguments);
        },

        playPause: function() {
          if(this.$.player.paused) {
            this.$.player.play();
          } else {
            this.$.player.pause();
          }
          this.updateIcon();
        },

        setStation: function(station) {
          this.url = station.url;
          this.name = station.name;
          setTimeout(this.playPause.bind(this), 0);
        }
      });

    })();
  </script>
</dom-module>
